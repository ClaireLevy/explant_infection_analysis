---
title: "Explant titrations"
date:
author:
output: github_document
  
---



### Goal

Titrate lot2 of vNL_sNLuc_6ATRi.B.Bal.ecto based on the kinetics of RA and KW's virus; "Bal26 lot1", at the concentration that they use for infection experiments (1.92E6 pfu/ml)
 
## Titration 001

This is a plot of luciferase production over days 1 - 14 for multiple conditions. The "Hladik Bal lot2" virus is vNL_sNLuc_6ATRi.B.Bal.ecto lot2 made by Greg Mize.

* Day 1 supernatent still contains input virus. 1 wash is still day 1 but after the explants have been washed to remove input virus. 

* Hladik Bal26 lot2 with pfu/ml of 3.64E5 or 7.27E5 (dil. factors 68.76, 34.38) look closest to RA/KW's virus.



```{r echo=FALSE, message=FALSE, warning=FALSE}

library(plyr)
library(dplyr)
library(plateR)
library(ggplot2)


#Read in data collected 07June16 from day1-day14. I put the raw data into a file with the meta data in plateR format

titer001_day1_14<-read_plate("../Explant_titration_001/07June16_plate_layout_and_data.csv")

#order the factors nicely
titer001_day1_14$Day <- factor(titer001_day1_14$Day,levels = c("1","1 wash","3","7","10","14"))

#make the pfu/ml into factors, then rename the factors so the number ones are in sci not.

titer001_day1_14$pfu_per_ml <- factor(titer001_day1_14$pfu_per_ml)


titer001_day1_14$pfu_per_ml <- mapvalues (titer001_day1_14$pfu_per_ml,from =c(1450000,1920000,2880000,364000,5810000,727000), to = c("1.45E6","1.92E6","2.88E6","3.64E5","5.81E6","7.27E5"))
                                                                         
ggplot(titer001_day1_14, aes(x = Day, y = RLU))+
  geom_point(aes(color = pfu_per_ml, shape = Virus),size = 3)+
  geom_line(aes(group = pfu_per_ml, color = pfu_per_ml))+
  scale_shape_manual(values = c("Hladik Bal lot2" = 16, "Bal26 lot2" = 1, "No virus" = 4))+
  scale_y_log10()
  
  


```
----
This is a plot of the luciferase over time from day1- 21 but we included fewer conditions based on the results from the first run of d1-14 with all conditions. 

* Hladik Bal26 lot2 with a pfu/ml of 7.27E5 (dil. factor of 34.38) looks closest to Bal26 lot1.


```{r echo=FALSE, message=FALSE, warning=FALSE}


#Read in data collected 16June16 from day1-day21.We only ran conditions "A","C",and "D" and Bal lot 26. I put the raw data into a file with the meta data in plateR format. 

titer001_day1_21ACD<-read_plate("../Explant_titration_001/16June16_plate_layout_and_data.csv")


titer001_day1_21ACD$Day <- factor(titer001_day1_21ACD$Day,levels = c("1 wash","3","7","10","14","17","21"))


titer001_day1_21ACD$pfu_per_ml <- mapvalues (titer001_day1_21ACD$pfu_per_ml,from =c(1920000,1450000, 2880000,727000), to = c("1.92E6","1.45E6","2.88E6","7.27E5"))


#make the dilution factor character so it plays nicely with other dfs that don't non-numeric entries for dil factor ("no virus")
titer001_day1_21ACD$Dilution_factor <-as.character(titer001_day1_21ACD$Dilution_factor)
                   
ggplot(titer001_day1_21ACD, aes(x = Day, y = RLU))+
  geom_point(aes(color = pfu_per_ml, shape = Virus),size = 3)+
  geom_line(aes(group = pfu_per_ml, color =pfu_per_ml))+
  scale_shape_manual(values = c("Hladik Bal lot2" = 16, "Bal26 lot1" = 1, "No virus" = 4))+
  scale_y_log10()


titer001first <- titer001_day1_14%>%
  filter(Condition == "D", Day == "10")

titer001second<-titer001_day1_21ACD%>%
  filter(Condition == "D", Day == "10")


```
----
## Titration 002

Lucia set up a second titration experiment on 14June16. 

* Hladik Bal with a dilution factor of 5.4E5 (dil. factor 46.3) matches the kinetics of Bal26 lot1.


```{r echo=FALSE, message=FALSE, warning=FALSE}
#Read in data from 07July16 nanoluc assay.

titer002_day1_21<-read_plate("../Explant_titration_002/06July16_plate_layout_and_data.csv")


titer002_day1_21$Day <- factor(titer002_day1_21$Day,levels = c("1","1 wash","3","6","8","10","13","15","17", "21"))



titer002_day1_21$pfu_per_ml <- mapvalues (titer002_day1_21$pfu_per_ml,from =c(1600000,1920000, 1e+06,2400000, 540000), to = c(
  "1.6E6", "1.92E6","1E6","2.4E6","5.4E5"))




ggplot(titer002_day1_21, aes(x = Day, y = RLU))+
  geom_point(aes(color = pfu_per_ml, shape = Virus),size = 3)+
  geom_line(aes(group = pfu_per_ml, color =pfu_per_ml))+
  scale_shape_manual(values = c("Hladik Bal lot2" = 16, "Bal26 lot1" = 1, "No virus" = 4))+
  scale_y_log10()
```
----
This is all data for all experiments



```{r echo=FALSE, message=FALSE, warning=FALSE}

#combine all the data and plot together

all_data <- list(titer001_day1_21ACD, titer001_day1_14, titer002_day1_21)

names(all_data)<- c("titer001_day1_21ACD","titer001_day1_14","titer002_day1_21")

all_data<- bind_rows(all_data, .id = "Experiment")

all_data$Day <-factor(all_data$Day)

all_data$Day <-factor(all_data$Day, levels = c("1","1 wash", "3","6","7","8","10","13","14","15","17","21"))


#make a column with a unique entry for each row that I can use in the group argument for geom_line


all_data <- all_data %>%
  mutate (UniqueID = paste(Experiment, Virus, Dilution_factor, sep = "_"))



ggplot(all_data, aes(x = Day, y = RLU))+
  geom_point(aes(shape = Virus, color = Experiment), size = 3)+
  geom_line(aes(group = UniqueID, color = Experiment))+
  scale_shape_manual(values = c("Hladik Bal lot2" = 16, "Bal26 lot2" = 1, "No virus" = 4))+
  scale_y_log10()+
  theme(axis.text.x = element_text(angle = 25))

```



## Conclusions

* Based on three nanoluc assays from two different titrations, the dilution factors for Hladik Bal lot2 virus that resulted in kinetics that were closest to Bal26 lot1 were 3.64E5, 5.4E5, 7.27E5 (dilution factors of 68.76, 46.3, 34.38) .
